(()=>{var e={};e.id=419,e.ids=[419],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},2412:e=>{"use strict";e.exports=require("assert")},4735:e=>{"use strict";e.exports=require("events")},9021:e=>{"use strict";e.exports=require("fs")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},1820:e=>{"use strict";e.exports=require("os")},3873:e=>{"use strict";e.exports=require("path")},7910:e=>{"use strict";e.exports=require("stream")},3997:e=>{"use strict";e.exports=require("tty")},9551:e=>{"use strict";e.exports=require("url")},8354:e=>{"use strict";e.exports=require("util")},4075:e=>{"use strict";e.exports=require("zlib")},1037:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>o.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d});var r=s(260),i=s(8203),a=s(5155),o=s.n(a),n=s(7292),l={};for(let e in n)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);s.d(t,l);let d=["",{children:["admin",{children:["books",{children:["add",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,2424)),"/infinite-drive-v2/frontend/src/app/admin/books/add/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,6038)),"/infinite-drive-v2/frontend/src/app/admin/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,1354)),"/infinite-drive-v2/frontend/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,9937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,9116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,1485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/infinite-drive-v2/frontend/src/app/admin/books/add/page.tsx"],u={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/admin/books/add/page",pathname:"/admin/books/add",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7559:(e,t,s)=>{Promise.resolve().then(s.bind(s,2424))},2287:(e,t,s)=>{Promise.resolve().then(s.bind(s,9736))},9736:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var r=s(5512),i=s(8009),a=s(9334),o=s(5668),n=s(2149);function l({bonusItems:e,onChange:t,maxBonuses:s=5}){let[a,o]=(0,i.useState)(!1),[n,l]=(0,i.useState)(!1),d={basic:[{title:"Quick Start Guide",description:"Get started with the core concepts in just 15 minutes",type:"pdf"},{title:"Key Concepts Cheat Sheet",description:"A handy reference of all important techniques",type:"pdf"}],standard:[{title:"Quick Start Guide",description:"Get started with the core concepts in just 15 minutes",type:"pdf"},{title:"Key Concepts Cheat Sheet",description:"A handy reference of all important techniques",type:"pdf"},{title:"Workbook",description:"Practical exercises to reinforce your learning",type:"pdf"}],premium:[{title:"Quick Start Guide",description:"Get started with the core concepts in just 15 minutes",type:"pdf"},{title:"Key Concepts Cheat Sheet",description:"A handy reference of all important techniques",type:"pdf"},{title:"Workbook",description:"Practical exercises to reinforce your learning",type:"pdf"},{title:"Video Tutorial",description:"Visual walkthrough of advanced techniques",type:"video"},{title:"Audio Summary",description:"Listen to key takeaways on the go",type:"audio"}]},c=r=>{let i=Array(r).fill(null).map(()=>({title:"",description:"",type:"text"})),a=s-e.length;t([...e,...i.slice(0,a)]),l(!1)},u=r=>{let i=d[r],a=s-e.length;t([...e,...i.slice(0,a)]),o(!1)},p=r=>{if(e.length<s){let s=[...e],i={...s[r],file:null};i.title=`${i.title} (Copy)`,s.splice(r+1,0,i),t(s)}},m=s=>{let r=[...e];r.splice(s,1),t(r)},x=(s,r,i)=>{let a=[...e];a[s]={...a[s],[r]:i},t(a)};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h3",{className:"text-lg font-medium",children:"Bonus Sections"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>o(!a),className:"px-3 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm font-medium hover:bg-blue-100",children:["Templates",(0,r.jsx)("svg",{className:"w-4 h-4 ml-1 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-10 border",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsx)("button",{type:"button",onClick:()=>u("basic"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Basic Package (2 bonuses)"}),(0,r.jsx)("button",{type:"button",onClick:()=>u("standard"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Standard Package (3 bonuses)"}),(0,r.jsx)("button",{type:"button",onClick:()=>u("premium"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Premium Package (5 bonuses)"})]})})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>l(!n),className:`px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700 ${e.length>=s?"opacity-50 cursor-not-allowed":""}`,disabled:e.length>=s,children:["Add Bonus",(0,r.jsx)("svg",{className:"w-4 h-4 ml-1 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&(0,r.jsx)("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-md shadow-lg z-10 border",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{e.length<s&&t([...e,{title:"",description:"",type:"text"}]),l(!1)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Add Single Bonus"}),(0,r.jsx)("button",{type:"button",onClick:()=>c(2),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Add 2 Bonuses"}),(0,r.jsx)("button",{type:"button",onClick:()=>c(3),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Add 3 Bonuses"})]})})]})]})]}),0===e.length?(0,r.jsxs)("p",{className:"text-sm text-gray-500 italic p-4 bg-gray-50 border border-dashed border-gray-300 rounded-lg text-center",children:["No bonus sections added. You can add up to ",s," bonus sections."]}):(0,r.jsx)("div",{className:"space-y-6",children:e.map((t,i)=>(0,r.jsxs)("div",{className:"p-4 border rounded-lg bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsxs)("h4",{className:"font-medium",children:["Bonus Section #",i+1]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>p(i),disabled:e.length>=s,className:`text-blue-600 hover:text-blue-800 ${e.length>=s?"opacity-50 cursor-not-allowed":""}`,children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,r.jsx)("button",{type:"button",onClick:()=>m(i),className:"text-red-600 hover:text-red-800",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,r.jsx)("input",{type:"text",required:!0,value:t.title,onChange:e=>x(i,"title",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"e.g., Bonus Workbook, Cheat Sheet, etc."})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),(0,r.jsx)("textarea",{required:!0,value:t.description,onChange:e=>x(i,"description",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Describe what this bonus includes",rows:3})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bonus Type"}),(0,r.jsxs)("select",{value:t.type||"text",onChange:e=>x(i,"type",e.target.value),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"text",children:"Text Only"}),(0,r.jsx)("option",{value:"pdf",children:"PDF Document"}),(0,r.jsx)("option",{value:"audio",children:"Audio"}),(0,r.jsx)("option",{value:"video",children:"Video"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cover Image"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>x(i,"coverImage",e.target.files?.[0]||null),className:"w-full"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Upload an image to display for this bonus item"}),t.coverImage&&(0,r.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["Selected cover image: ",t.coverImage.name]}),!t.coverImage&&t.coverImagePath&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("p",{className:"text-xs text-blue-600 mb-1",children:"Current cover image:"}),(0,r.jsx)("img",{src:t.coverImagePath,alt:`Cover for ${t.title}`,className:"h-16 w-auto object-contain"})]})]}),t.type&&"text"!==t.type&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"File Upload"}),(0,r.jsx)("input",{type:"file",accept:"pdf"===t.type?".pdf":"audio"===t.type?"audio/*":"video"===t.type?"video/*":"*/*",onChange:e=>x(i,"file",e.target.files?.[0]||null),className:"w-full"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"pdf"===t.type?"Upload a PDF document":"audio"===t.type?"Upload an audio file (MP3, WAV, etc.)":"video"===t.type?"Upload a video file (MP4, etc.)":""}),t.file&&(0,r.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["Selected file: ",t.file.name]})]})]})]},i))})]})}let d=require("crypto"),c={randomUUID:d.randomUUID},u=new Uint8Array(256),p=u.length,m=[];for(let e=0;e<256;++e)m.push((e+256).toString(16).slice(1));let x=function(e,t,s){if(c.randomUUID&&!t&&!e)return c.randomUUID();let r=(e=e||{}).random??e.rng?.()??(p>u.length-16&&((0,d.randomFillSync)(u),p=0),u.slice(p,p+=16));if(r.length<16)throw Error("Random bytes length must be >= 16");if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){if((s=s||0)<0||s+16>t.length)throw RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[s+e]=r[e];return t}return function(e,t=0){return(m[e[t+0]]+m[e[t+1]]+m[e[t+2]]+m[e[t+3]]+"-"+m[e[t+4]]+m[e[t+5]]+"-"+m[e[t+6]]+m[e[t+7]]+"-"+m[e[t+8]]+m[e[t+9]]+"-"+m[e[t+10]]+m[e[t+11]]+m[e[t+12]]+m[e[t+13]]+m[e[t+14]]+m[e[t+15]]).toLowerCase()}(r)};function h(){let e=(0,a.useRouter)(),[t,s]=(0,i.useState)(!1),[d,c]=(0,i.useState)(0),[u,p]=(0,i.useState)({bookId:"",title:"",description:"",heading:"",subheading:"",price:"",formats:["pdf"],coverImage:null,ebooks:{},bonusItems:[]}),m=async t=>{t.preventDefault(),s(!0),c(0);try{if(!u.title||!u.description||!u.price)throw Error("Please fill in all required fields");if(!u.coverImage)throw Error("Cover image is required");let t=new FormData;console.log("\uD83D\uDE80 ~ handleSubmit ~ data:",t);let s=x();t.append("id",s),t.append("title",u.title),t.append("description",u.description),t.append("heading",u.heading),t.append("subheading",u.subheading),t.append("price",u.price),t.append("formats",u.formats.join(",")),u.coverImage&&t.append("coverImage",u.coverImage),u.formats.forEach(e=>{let s=u.ebooks[e];s&&t.append("ebooks",s)});let r=[];for(let e of u.bonusItems){let s={title:e.title,description:e.description,type:e.type||"text"};e.file&&e.type&&"text"!==e.type&&(t.append("ebooks",e.file),s.fileName=e.file.name),e.coverImage&&(t.append("ebooks",e.coverImage),s.coverImageFileName=e.coverImage.name),r.push(s)}r.length>0&&t.append("bonuses",JSON.stringify(r));let i=localStorage.getItem("token");console.log("Sending data to server:",{id:s,title:u.title,description:u.description,price:u.price,formats:u.formats.join(","),bonuses:r}),console.log("Files being uploaded:",{coverImage:u.coverImage?.name,ebooks:Object.entries(u.ebooks).map(([e,t])=>`${e}: ${t?.name}`),bonusFiles:u.bonusItems.filter(e=>e.file&&"text"!==e.type).map(e=>`${e.type}: ${e.file?.name}`)});let a=await o.A.post("https://infinitedriven.com/api/books/add",t,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${i}`},timeout:12e4,onUploadProgress:e=>{let t=e.total?Math.round(100*e.loaded/e.total):0;c(t)}});console.log("\uD83D\uDE80 ~ handleSubmit ~ response:",a),console.log("Book added successfully:",a.data),e.push("/admin/books")}catch(e){if(console.error("Error adding book:",e),o.A.isAxiosError(e)){console.log("Error response:",e.response?.data);let t=e.response?.data?.error||e.response?.data?.message||"Error uploading book";e.response?.status===413?alert("File size too large - Maximum size is 100MB"):e.response?.status===400?alert(`Bad request: ${t}`):alert(`Server error (${e.response?.status||"unknown"}): ${t}`)}else e instanceof Error?alert(e.message):alert("An unexpected error occurred")}finally{s(!1),c(0)}};return(0,r.jsx)("div",{className:"max-w-3xl mx-auto p-6",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Add New Book"}),(0,r.jsxs)("form",{onSubmit:m,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,r.jsx)("input",{type:"text",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",value:u.title,onChange:e=>p({...u,title:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),(0,r.jsx)("textarea",{required:!0,rows:4,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",value:u.description,onChange:e=>p({...u,description:e.target.value})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price ($) *"}),(0,r.jsx)("input",{type:"number",step:"0.01",min:"0",required:!0,className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",value:u.price,onChange:e=>p({...u,price:e.target.value})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Available Formats *"}),(0,r.jsx)("div",{className:"flex gap-4",children:["pdf","epub"].map(e=>(0,r.jsxs)("label",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",checked:u.formats.includes(e),onChange:t=>{let s=t.target.checked?[...u.formats,e]:u.formats.filter(t=>t!==e);p({...u,formats:s})},className:"mr-2"}),e]},e))})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Heading"}),(0,r.jsx)("input",{type:"text",value:u.heading,onChange:e=>p({...u,heading:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Main marketing heading"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subheading"}),(0,r.jsx)("input",{type:"text",value:u.subheading,onChange:e=>p({...u,subheading:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Supporting subheading text"})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cover Image *"}),(0,r.jsx)("input",{type:"file",accept:"image/*",required:!0,onChange:e=>p({...u,coverImage:e.target.files?.[0]||null}),className:"w-full"})]}),u.formats.map(e=>(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[e," File *"]}),(0,r.jsx)("input",{type:"file",accept:"pdf"===e?".pdf":".epub",required:!0,onChange:t=>p({...u,ebooks:{...u.ebooks,[e]:t.target.files?.[0]}}),className:"w-full"})]},e))]}),(0,r.jsx)(l,{bonusItems:u.bonusItems,onChange:e=>p({...u,bonusItems:e}),maxBonuses:5}),d>0&&(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,r.jsx)("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${d}%`}})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,r.jsx)(n.A,{type:"button",className:"bg-gray-500 hover:bg-gray-600",onClick:()=>e.back(),disabled:t,children:"Cancel"}),(0,r.jsx)(n.A,{type:"submit",disabled:t,className:`bg-blue-600 hover:bg-blue-700 ${t?"opacity-50 cursor-not-allowed":""}`,children:t?`Uploading ${d}%`:"Add Book"})]})]})]})})}},2149:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var r=s(5512);function i({children:e,className:t="",onClick:s,type:i="button",...a}){return(0,r.jsx)("button",{type:i,className:`bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors ${t}`,onClick:s,...a,children:e})}},2424:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(6760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/infinite-drive-v2/frontend/src/app/admin/books/add/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/infinite-drive-v2/frontend/src/app/admin/books/add/page.tsx","default")}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[638,408,77,531,939],()=>s(1037));module.exports=r})();